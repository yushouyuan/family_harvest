# views.py 逻辑总结

在Django框架中，**views.py** 是**业务逻辑层**的核心文件，它负责：
1. 接收和处理HTTP请求
2. 与数据库交互（获取或修改数据）
3. 渲染模板并返回HTTP响应

---

## 项目中 `harvest/views.py` 各函数的具体作用

### 1. 装饰器函数
#### require_login
- 类型：自定义装饰器
- 参数：view
- 主要功能：用于保护需要登录的视图，未登录用户会自动重定向到登录页

### 2. 视图函数

#### login_view
- 参数：request
- 主要功能：处理用户登录请求，验证用户并设置session
- 流程：
  1. 接收登录请求
  2. 从数据库获取所有家庭成员信息
  3. 如果是POST请求，验证用户选择的成员
  4. 将成员信息存入session
  5. 重定向到首页

#### logout_view
- 参数：request
- 主要功能：处理用户登出请求，清除session

#### index
- 参数：request
- 主要功能：首页视图，展示今日家庭汇总记录
- 流程：
  1. 检查用户是否已登录
  2. 获取当天日期和所有家庭成员
  3. 查询当天所有成员的记录并分组
  4. 渲染模板并返回首页

#### add_or_edit_record
- 参数：request, record_id=None
- 主要功能：添加或编辑每日记录的视图
- 流程：
  1. 检查用户是否已登录
  2. 如果是POST请求，验证表单数据
  3. 将数据保存到数据库
  4. 重定向到首页
  5. 如果是GET请求，显示表单页面

#### history
- 参数：request
- 主要功能：历史记录视图，按时间线展示所有记录
- 流程：
  1. 检查用户是否已登录
  2. 查询所有记录并按日期倒序排列
  3. 渲染模板并返回历史记录页面

#### stats 
- 参数：request
- 主要功能：统计视图，展示个人记录统计信息
- 流程：
  1. 检查用户是否已登录
  2. 查询当前用户的记录总数
  3. 渲染模板并返回统计页面

---

## 技术特点
- 使用**函数式视图**实现业务逻辑
- 通过自定义装饰器 `require_login` 实现权限控制
- 使用Django的**模板系统**渲染HTML页面
- 与Django的**ORM系统**交互，无需编写原生SQL
- 遵循Django的请求-响应生命周期模式

## 角色定位
在MVC架构中，views.py 扮演**Controller**（控制器）的角色，是用户请求和业务逻辑之间的桥梁。

